---
title: "HUGOのTOCを見直す簡単なお仕事"
date: 2020-09-12T08:16:26+09:00
archives: "2020/09"
tags: ["Disney","舞浜日記","ディズニーホテル"]
author: toshikun
draft: false
toc: false
head1tag: "HUGOのTOCってなかなかイケてない"
description: "HUGOのTOC(Table of Contents)を改良した"
featured_image: "https://lh3.googleusercontent.com/73of9Z9NjCb6uEmmSTnvCx6Aukk3UpfwyKIYnpUpiqDVz7Ym1-1jpqkcWy6k3jo1qRvBgSkDp9EMvP5b5M-q2b6YEnd233giJE54eJ12sVyhN7TIMA1Zd6bJYjRKEKiQv_CXb-xCUg=w400"
---
ここ最近、自分で書いた記事を見直すことが多いんですが

hugoに備わってるTOC(Table of Contents)、いわゆる目次を表示させる機能がうまく動いてなかったので見直すことにしてみました。

かかった時間は3日間くらい。ほんとにしんどかった。

ということで本題

{{< toc "Contents" >}}

## 問題点
---
TOCに関してローカルサーバーではちゃんと動くのにnetlifyとかにデプロイすると若干出力が違っていたのに気づいた。

違和感MAXだったので原因を探ってみる。

### 具体的な症状

どんなことが起きていたかというと

こんな感じでローカルで表示されていたんですが

デプロイされた実際の表示はこんな感じ。



## 状況と方向性を考えてみる
---

そもそもHUGOでのTOCの表示は
{{< highlight mkd >}}
# 見出し1

## 見出し2

### 見出し3
{{< / highlight >}}

のように見出し部分をうまく利用して目次を作成できる機能がついています。  

問題が起きてた記事には`h1`にあたる`# 見出し1`を書いてないため`ulタグ`が余ったんじゃないかなと推察しました。

余計な`ulタグ`を表示したくないのはなぜかというとこれをしたいから。

>**※以下外部リンクです**
><div class="blogcard"><div class="blogcard-content"><div class="blogcard-image"><div class="blogcard-image-wrapper"><a href="https://jyn.jp/hugo-toc-in-contents/" target="_blank"><img src="https://jyn.jp/wp-core/wp-content/uploads/2019/05/hugo-toc-in-contents-002.png" alt=""></a></div></div><div class="blogcard-text"><p class="blogcard-title"><a href="https://jyn.jp/hugo-toc-in-contents/" target="_blank">【Hugo】Table of Contentsをjsなしでコンテンツの中に移動する | 純規の暇人趣味ブログ</a></p><p class="blogcard-description">ブログの更新サボってるので頑張っていきます。タイトルはSEO的理由で一つに絞っただけで、他にもいろいろ紹介。HugoのTocは少し機能が貧弱気味なので、それを自力で解決する方法。JavaScriptはナシで。</p></div></div><div class="blogcard-footer"><a href="https://jyn.jp/hugo-toc-in-contents/" target="_blank"><img src="https://www.google.com/s2/favicons?domain=https://jyn.jp/hugo-toc-in-contents/" alt="">jyn.jp</a></div></div>

前からこちらで紹介されているようなことができればと考えていましたが(というか、なっていると思ってたらなってなかった。)
具体的にはコンテンツの中(`## 見出し2`の直前に)TOCを表示させるのが目標。


### 是正対応①
---
まずは上記で紹介した通りにhtmlとかを修正してみます。

・**layouts\_default\single.html**

{{< blogcard title="hugoで目次(toc)を導入する" posturl="https://toshikunblog.net/post/20200610/" description="かねてから実装しようと思っていた目次(俗にいうtable of contents)を重い腰を上げて今回このブログにも導入しました。" >}}
修正前については以前記事にしているので上記を参照してみてください。

**〇修正前〇**
{{< highlight Go HTML Template >}}
{{ define "main" }}

<div class="columns">
    <div class="column is-9">
        <div class="tile is-child box">
            <div class="content">
                {{- /* ↓これ */ -}}
                {{ .Content }}
            </div>
        </div>
    </div>
    <div class="column is-3">
        {{ partial "widget-tags.html" . }}<br>
        {{ partial "widget-recent.html" . }}<br>
        {{ partial "widget-related.html" . }}<br>
        {{ partial "widget-archives.html" . }}
    </div>
</div>
{{ end }}
{{< / highlight >}}

**〇修正後〇**
{{< highlight Go HTML Template >}}
{{ define "main" }}

<div class="columns">
    <div class="column is-9">
        <div class="tile is-child box">
            <div class="content">
　　　　　　　　　{{- /* ここから */ -}}
　　　　　　　　　{{- if (.Param "tocMove" ) -}}
                    {{- $header := (findRE "<h[1-6].*?>(?:.|\n)*?</h[1-6]>" .Content) -}}
                    {{- $firstH := index $header 0 -}}

                        {{- if ne $firstH nil -}}
                            {{- $newH := printf `%s%s` .TableOfContents $firstH -}}
                            {{- replace .Content $firstH $newH | safeHTML -}}
                        {{- else -}}
                            {{- .Content -}}
                　    {{- end -}}
                {{- else -}}
                　    {{- .TableOfContents -}}
                　    {{- .Content -}}
                {{- end -}}
                {{- /* ここまで */ -}}
            </div>
        </div>
    </div>
    <div class="column is-3">
        {{ partial "widget-tags.html" . }}<br>
        {{ partial "widget-recent.html" . }}<br>
        {{ partial "widget-related.html" . }}<br>
        {{ partial "widget-archives.html" . }}
    </div>
</div>
{{ end }}
{{< / highlight >}}

---

さらに冒頭で紹介したブログには

hugoにおける`ul` `ol` `li`の記述もあったので参考にCSSに反映させてみた。

しかしうまくいかなかったのであきらめました。とほほ...

### 是正対応②
---
公式サイトにTOCについて記述があったのでいろいろ試してみた。
[HUGO公式サイト](https://gohugo.io/getting-started/configuration-markup/#table-of-contents)


なにやら`config.toml`にいろいろ書き加えるとTOCに表示させる`h1`などのレベルを指定することができるらしい。
{{< highlight toml >}}
[markup]
  [markup.tableOfContents]
    #trueにすると`ol`表記で出力しfalseにすると`ul`表記で出力する。
    ordered = false
    #`=1`にすると`# 見出し1`から、`=2`にすると`## 見出し2`から・・・という具合にTOCに表示させる見出しのスタートの位置が指定できる。
    startLevel = 2
    #startがあればendもある。ちなみに↓の場合だと`## 見出し2`と`### 見出し 3`がTOCに表示される(らしい)
    endLevel = 3
{{< / highlight >}}



### チェックイン方法(Gotoキャンペーンについて)


### サローネ・デッラミーコ

室内はこんな感じ。
チェックイン日にちであれば14時から利用できます。先にひとやすみするのもありかと思います。

<img src="https://lh3.googleusercontent.com/eZf5qWmmDt0Ysb4GyBC4Tye8I8uDBqKztr2eCLoULPn_pKdaAZUEYAZZV87enMnrzMk0jH6cGGJLb-YikU4dhC2ZFciv8jZYTtbxDEAO7HKBPrvMf1hm51MoGFc9_5opgNAreGRVzw=w800" >





##　参考にさせて頂いたサイト様