<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>Toshikun Dlife  | Pythonでsshをしてみる</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link href="https://fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bulma/0.7.1/css/bulma.min.css" />
    <link rel="stylesheet" href="https://toshikunblog.net/css/blog.css" />
    <link rel="stylesheet" href="https://toshikunblog.net/css/syntax.css" />
    

<script async src="https://www.googletagmanager.com/gtag/js?id=UA-165344098-1"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', 'UA-165344098-1');
</script>
<script data-ad-client="ca-pub-4385015283597896" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>

<link rel="apple-touch-icon" sizes="57x57" href="https://toshikunblog.net/img/favicon/apple-icon-57x57.png">
<link rel="apple-touch-icon" sizes="60x60" href="https://toshikunblog.net/img/favicon/apple-icon-60x60.png">
<link rel="apple-touch-icon" sizes="72x72" href="https://toshikunblog.net/img/favicon/apple-icon-72x72.png">
<link rel="apple-touch-icon" sizes="76x76" href="https://toshikunblog.net/img/favicon/apple-icon-76x76.png">
<link rel="apple-touch-icon" sizes="114x114" href="https://toshikunblog.net/img/favicon/apple-icon-114x114.png">
<link rel="apple-touch-icon" sizes="120x120" href="https://toshikunblog.net/img/favicon/apple-icon-120x120.png">
<link rel="apple-touch-icon" sizes="144x144" href="https://toshikunblog.net/img/favicon/apple-icon-144x144.png">
<link rel="apple-touch-icon" sizes="152x152" href="https://toshikunblog.net/img/favicon/apple-icon-152x152.png">
<link rel="apple-touch-icon" sizes="180x180" href="https://toshikunblog.net/img/favicon/apple-icon-180x180.png">
<link rel="icon" type="image/png" sizes="192x192"  href="https://toshikunblog.net/img/favicon/android-icon-192x192.png">
<link rel="icon" type="image/png" sizes="32x32" href="https://toshikunblog.net/img/favicon/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="96x96" href="https://toshikunblog.net/img/favicon/favicon-96x96.png">
<link rel="icon" type="image/png" sizes="16x16" href="https://toshikunblog.net/img/favicon/favicon-16x16.png">
<link rel="manifest" href="https://toshikunblog.net/img/favicon/faviconmanifest.json">
<meta name="msapplication-TileColor" content="#ffffff">
<meta name="msapplication-TileImage" content="/ms-icon-144x144.png">
<meta name="theme-color" content="#ffffff">

<meta property="og:title" content="Pythonでsshをしてみる" />
<meta property="og:description" content="pythonでsshログインを自動的にできるようにしてみたかったのでやってみました。この程度ならTeratermのほうが簡単かも" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://toshikunblog.net/post/20200728/" />
<meta property="og:image" content="https://toshikunblog.net/img/images.jpg"/>
<meta property="article:published_time" content="2020-07-28T08:16:26+09:00" />
<meta property="article:modified_time" content="2020-07-28T08:16:26+09:00" /><meta property="og:site_name" content="Toshikun Dlife" />

<meta property="og:locale" content="ja_JP" />
<meta property="twitter:card" content="summary"/>
<meta property="twitter:image" content="https://toshikunblog.net/img/images.jpg"/>
<meta property="twitter:title" content="Toshikun Dlife"/>
<meta property="twitter:description" content="pythonでsshログインを自動的にできるようにしてみたかったのでやってみました。この程度ならTeratermのほうが簡単かも"/>
</head>
<body>
    <meta name="google-site-verification" content="KeyqW3agkc-qs5Cu98SomK9YFLKxvCpChF9yBPIXEWo" />
    
    <nav class="navbar is-fixed-top" role="navigation" aria-label="main navigation">
        <div class="navbar-brand">
            <a class="navbar-item" href="https://toshikunblog.net/">Home</a>
            <a class="navbar-item" href="https://toshikunblog.net/page/about">About me</a>
        </div>
    </nav>
    

    
    <section class="hero is-info is-medium">
        <div class="hero-body" style="background-image: url(https://toshikunblog.net/img/header-1.jpg);">
            <div class="container has-text-centered">
                <br>
                <h1 class="title is-size-1">
                    
                        Pythonでsshをしてみる
                    
                </h1>
                
            </div>
        </div>
    </section>


<div class="container">
    <div class="section">
    

<div class="columns">
    <div class="column is-9">
        <div class="tile is-child box">
            <div class="content">
                
                    
                    
                      
                      <hr>
<h1 id="今結構前から流行りの自動化を">今(結構前から)流行りの自動化を&hellip;</h1>
<hr>
<p>なんやかんやしていたらもう7月終わりそうですね。</p>
<p>さて今回はネットワークエンジニアちっくな記事になりそうな予感。</p>
<p>『Ok! Google!Pythonでネットワーク業務を自動化するscriptを書いてよ!』と、いつ頼まれても大丈夫なようにPythonを使っていろんなことができるようにスクリプトを書いていきたいと思います。</p>
<section class="toc">
    <div style="padding: 20px; border: solid 0.1px rgb(0, 0, 0); background-color: rgb(248, 248, 248);">
    <h4>Contents</h4>
    <nav id="TableOfContents">
  <ol>
    <li><a href="#1-とりあえずやってみる">1. とりあえずやってみる</a>
      <ol>
        <li><a href="#-コード">§ コード</a></li>
        <li><a href="#-正体を突き止めていくっ">§ 正体を突き止めていくっ‼</a></li>
        <li><a href="#-str型に変換する">§ str型に変換する</a></li>
      </ol>
    </li>
    <li><a href="#2-リトライ">2. リトライ</a></li>
    <li><a href="#3-コードの解釈">3. コードの解釈</a></li>
    <li><a href="#4-まとめ">4. まとめ</a></li>
    <li><a href="#5-referenceacknowledgment">5. Reference＆Acknowledgment</a></li>
  </ol>
</nav>
  </div>
  </section>
<h2 id="1-とりあえずやってみる">1. とりあえずやってみる</h2>
<p>今回はとある機器にssh接続をしてコマンドを入力し出力結果を保存することが最終目標!
はじめは「python ssh」とかで調べました。すると同じようなことを考えている人は結構いた。</p>
<h3 id="-コード">§ コード</h3>
<p>今回使うモジュールはparamikoです。
anacondaを入れていれば標準で使えますがインストールしていない人はpipでparamikoをinstallしておいてくださいね。
ちなみにAnsible(Pythonベースのオープンソース構成管理ツール)でもParamikoが使われているみたい。</p>
<p>予断はさておき、まず初めにモジュールのimportしていきます。</p>
<p>【コード】
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-py" data-lang="py"><span style="color:#75715e"># モジュールのインポート</span>
<span style="color:#f92672">import</span> paramiko

<span style="color:#75715e"># 機器情報</span>
ip <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;172.168.1.1&#39;</span>
user_name <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;linunx-user&#39;</span>
password <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;Passw0rd&#39;</span>
command <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;ls&#39;</span>

<span style="color:#75715e"># コマンド</span>

client <span style="color:#f92672">=</span> paramiko<span style="color:#f92672">.</span>SSHClient()
client<span style="color:#f92672">.</span>set_missing_host_key_policy(paramiko<span style="color:#f92672">.</span>AutoAddPolicy())

<span style="color:#75715e"># ssh接続を開始するためのコマンド</span>
client<span style="color:#f92672">.</span>connect(ip, username<span style="color:#f92672">=</span>user_name, password<span style="color:#f92672">=</span>password, timeout<span style="color:#f92672">=</span><span style="color:#ae81ff">3.0</span>)
(stdin, stdout, stderr) <span style="color:#f92672">=</span> client<span style="color:#f92672">.</span>exec_command(command)
output <span style="color:#f92672">=</span> stdout<span style="color:#f92672">.</span>read()
client<span style="color:#f92672">.</span>close()
<span style="color:#66d9ef">print</span>(<span style="color:#e6db74">&#39;出力結果:&#39;</span>,output)</code></pre></div></p>
<p>【出力結果】</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">出力結果: b<span style="color:#e6db74">&#39;Bookshelf\nDesktop\nDocuments\nDownloads\nMusic\nPictures\nPublic\nTemplates\nVideos\nthinclient_drives\n&#39;</span></code></pre></div>
<p>うーん。ちょっと予想外。b'~~~~~~~~\n'って見たことない表記。</p>
<p>よくわからんので調べてみることにしました。</p>
<h3 id="-正体を突き止めていくっ">§ 正体を突き止めていくっ‼</h3>
<p><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-py" data-lang="py">(stdin, stdout, stderr) <span style="color:#f92672">=</span> client<span style="color:#f92672">.</span>exec_command(command)</code></pre></div>
上記から出力される結果ですがバイト型で出力されるとのこと。それをreadで読み込んでしまうとバイト型を文字列として扱ってしまうらしいです。(違ってたらすいませんんん)</p>
<p>自分でもよく理解していないのですが結果的に、str型に変換してやらないといけないみたいです。(逃げるっ</p>
<p>下記に参考URLを添付しておきますので参考までに。</p>
<p><a href="https://qiita.com/kuboshu83/items/1c2ad7afda0d9ce71d97">Python3での文字列のstr型とbytes型のまとめ</a></p>
<h3 id="-str型に変換する">§ str型に変換する</h3>
<p>変換すると言ってもやることは簡単。</p>
<p><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-py" data-lang="py"><span style="color:#75715e"># 変更点:decode</span>
output <span style="color:#f92672">=</span> stdout<span style="color:#f92672">.</span>read()<span style="color:#f92672">.</span>decode()
client<span style="color:#f92672">.</span>close()
<span style="color:#66d9ef">print</span>(<span style="color:#e6db74">&#39;出力結果:&#39;</span>,output)</code></pre></div>
これでもう一回試してみる。</p>
<h2 id="2-リトライ">2. リトライ</h2>
<p>【出力結果】</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">出力結果: Bookshelf
Desktop
Documents
Downloads
Music
Pictures
Public
Templates
Videos
thinclient_drives</code></pre></div>
<p>これでひとまずOKかな。</p>
<h2 id="3-コードの解釈">3. コードの解釈</h2>
<p>説明がてらコメントを残しておきました。間違っていたらすいません‼</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-py" data-lang="py"><span style="color:#75715e"># モジュールのインポート</span>
<span style="color:#f92672">import</span> paramiko

<span style="color:#75715e"># 機器情報(ip,ユーザーネーム、パスワード、実施コマンド)</span>
ip <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;172.168.1.1&#39;</span>
user_name <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;linunx-user&#39;</span>
password <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;Passw0rd&#39;</span>
command <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;ls&#39;</span>

<span style="color:#75715e"># main処理</span>
client <span style="color:#f92672">=</span> paramiko<span style="color:#f92672">.</span>SSHClient()
<span style="color:#75715e"># teratermでよく見かけるssh接続するときに出るセキュリティー警告文を回避するやつ</span>
client<span style="color:#f92672">.</span>set_missing_host_key_policy(paramiko<span style="color:#f92672">.</span>AutoAddPolicy())

<span style="color:#75715e"># ssh接続を開始するためのコマンド</span>
client<span style="color:#f92672">.</span>connect(ip, username<span style="color:#f92672">=</span>user_name, password<span style="color:#f92672">=</span>password, timeout<span style="color:#f92672">=</span><span style="color:#ae81ff">3.0</span>)

<span style="color:#75715e"># stdin, stdout, stderrについてはよくわからなかったので調べてみた(下にリンク張っておきますね)</span>
(stdin, stdout, stderr) <span style="color:#f92672">=</span> client<span style="color:#f92672">.</span>exec_command(command)
output <span style="color:#f92672">=</span> stdout<span style="color:#f92672">.</span>read()<span style="color:#f92672">.</span>decode()
client<span style="color:#f92672">.</span>close()
<span style="color:#66d9ef">print</span>(<span style="color:#e6db74">&#39;出力結果:&#39;</span>,output)</code></pre></div>
<h2 id="4-まとめ">4. まとめ</h2>
<p>今回は簡単なscriptでsshをやってみたわけですが、次回はTeratermマクロのようなコマンドリストからコマンドを投入できるようにと思っています。
他にもやりたいことは沢山あるので時間があれば挑戦していこうかと思います。</p>
<h2 id="5-referenceacknowledgment">5. Reference＆Acknowledgment</h2>
<p>今回はこちらのサイトを参考にさせて頂きました。ありがとうございます。</p>
<p>1,<a href="https://qiita.com/kuboshu83/items/1c2ad7afda0d9ce71d97">Python3での文字列のstr型とbytes型のまとめ</a></p>
<p>2,<a href="https://ymotongpoo.hatenablog.com/entry/20120205/1328406102">YAMAGUCHI::weblog</a></p>
<p>3,<a href="https://ja.raw3h.net/page/paramiko-how-to-ssh-and-transfer-files-with-python-ccd91f/">raw3h.net</a></p>
<p>4,<a href="https://did2memo.net/2017/07/31/jupyter-notebook-ssh/#stdoutread">情報科学屋さんを目指す人のメモ</a></p>

                    
                <div id="disqus_thread"></div>
<script type="application/javascript">
    var disqus_config = function () {
    
    
    
    };
    (function() {
        if (["localhost", "127.0.0.1"].indexOf(window.location.hostname) != -1) {
            document.getElementById('disqus_thread').innerHTML = 'Disqus comments not available by default when the website is previewed locally.';
            return;
        }
        var d = document, s = d.createElement('script'); s.async = true;
        s.src = '//' + "https-toshikunblog-net" + '.disqus.com/embed.js';
        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="https://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
            </div>
        </div>
    </div>
    <div class="column is-3">
        <div class="card">
    <div class="card-content">
        <h1 class="title is-5">Tags</h1>
        <div class="tags">
        
            <span class="tag"><a href="https://toshikunblog.net/tags/bat">bat</a></span>
        
            <span class="tag"><a href="https://toshikunblog.net/tags/camera">camera</a></span>
        
            <span class="tag"><a href="https://toshikunblog.net/tags/disney">disney</a></span>
        
            <span class="tag"><a href="https://toshikunblog.net/tags/github">github</a></span>
        
            <span class="tag"><a href="https://toshikunblog.net/tags/hugo">hugo</a></span>
        
            <span class="tag"><a href="https://toshikunblog.net/tags/lightroom">lightroom</a></span>
        
            <span class="tag"><a href="https://toshikunblog.net/tags/linux">linux</a></span>
        
            <span class="tag"><a href="https://toshikunblog.net/tags/mvno">mvno</a></span>
        
            <span class="tag"><a href="https://toshikunblog.net/tags/python">python</a></span>
        
            <span class="tag"><a href="https://toshikunblog.net/tags/rakuten%E3%83%A2%E3%83%90%E3%82%A4%E3%83%AB">rakutenモバイル</a></span>
        
            <span class="tag"><a href="https://toshikunblog.net/tags/raspberrypi">raspberrypi</a></span>
        
            <span class="tag"><a href="https://toshikunblog.net/tags/uq%E3%83%A2%E3%83%90%E3%82%A4%E3%83%AB">uqモバイル</a></span>
        
            <span class="tag"><a href="https://toshikunblog.net/tags/vpn">vpn</a></span>
        
            <span class="tag"><a href="https://toshikunblog.net/tags/youtube">youtube</a></span>
        
            <span class="tag"><a href="https://toshikunblog.net/tags/%E3%82%AB%E3%83%A1%E3%83%A9%E5%82%99%E5%BF%98%E9%8C%B2">カメラ備忘録</a></span>
        
            <span class="tag"><a href="https://toshikunblog.net/tags/%E3%82%B9%E3%83%94%E3%83%BC%E3%83%89%E3%83%86%E3%82%B9%E3%83%88">スピードテスト</a></span>
        
            <span class="tag"><a href="https://toshikunblog.net/tags/%E3%83%87%E3%82%A3%E3%82%BA%E3%83%8B%E3%83%BC%E3%83%9B%E3%83%86%E3%83%AB">ディズニーホテル</a></span>
        
            <span class="tag"><a href="https://toshikunblog.net/tags/%E3%83%8D%E3%83%83%E3%83%88%E3%83%AF%E3%83%BC%E3%82%AF">ネットワーク</a></span>
        
            <span class="tag"><a href="https://toshikunblog.net/tags/%E3%83%96%E3%83%AD%E3%82%B0">ブログ</a></span>
        
            <span class="tag"><a href="https://toshikunblog.net/tags/%E6%8A%80%E8%A1%93%E3%83%8D%E3%82%BF">技術ネタ</a></span>
        
            <span class="tag"><a href="https://toshikunblog.net/tags/%E8%88%9E%E6%B5%9C%E6%97%A5%E8%A8%98">舞浜日記</a></span>
        
            <span class="tag"><a href="https://toshikunblog.net/tags/%E9%9B%91%E8%A8%98">雑記</a></span>
        
        </div>          
    </div>
</div><br>
        <div class="card">
    <div class="card-content">
        <h1 class="title is-5">Recent posts</h1>
        
            <h1><a href="https://toshikunblog.net/post/20200907/">ホテルミラコスタ滞在記【2020/08】Part②</a></h1>
            <time class="has-text-grey-light is-size-7">7 September 2020</time>
        
            <h1><a href="https://toshikunblog.net/post/20200905/">ホテルミラコスタ滞在記【2020/08】Part①</a></h1>
            <time class="has-text-grey-light is-size-7">5 September 2020</time>
        
            <h1><a href="https://toshikunblog.net/post/20200728/">Pythonでsshをしてみる</a></h1>
            <time class="has-text-grey-light is-size-7">28 July 2020</time>
        
            <h1><a href="https://toshikunblog.net/post/20200724/">hugoでよく使うお作法</a></h1>
            <time class="has-text-grey-light is-size-7">24 July 2020</time>
        
            <h1><a href="https://toshikunblog.net/post/20200717/">ラズパイでVPN(WireGuard)を構築した</a></h1>
            <time class="has-text-grey-light is-size-7">17 July 2020</time>
        
    </div>
</div>
    <br>
                
  



<div class="card">
    <div class="card-content">
        <h1 class="title is-5">Related posts</h1>
      
      
            <h1><a href="https://toshikunblog.net/post/20200724/">hugoでよく使うお作法</a></h1>
            <time class="has-text-grey-light is-size-7">24 July 2020</time>
      
            <h1><a href="https://toshikunblog.net/post/20200717/">ラズパイでVPN(WireGuard)を構築した</a></h1>
            <time class="has-text-grey-light is-size-7">17 July 2020</time>
      
    </div>
</div>

    
<br>
        <div class="card">
    <div class="card-content">
        <h1 class="title is-5">Archives</h1>
        
            <a href="https://toshikunblog.net/archives/2020/09">2020/09</a> (2)<br>
        
            <a href="https://toshikunblog.net/archives/2020/07">2020/07</a> (3)<br>
        
            <a href="https://toshikunblog.net/archives/2020/06">2020/06</a> (1)<br>
        
            <a href="https://toshikunblog.net/archives/2020/05">2020/05</a> (4)<br>
        
            <a href="https://toshikunblog.net/archives/2020/04">2020/04</a> (1)<br>
        
            <a href="https://toshikunblog.net/archives/2020/03">2020/03</a> (4)<br>
        
    </div>
</div>

    </div>
</div>


    </div>
</div>

<footer class="footer has-background-grey-darker has-text-white">
    <div class="content has-text-centered">
        <p>
            <span class="icon is-large"><a href="https://twitter.com/toshikun_photo" class="mysocial" rel="me"><i class="fab fa-twitter fa-3x"></i></a></span>&nbsp;&nbsp;
            <span class="icon is-large"><a href="https://www.youtube.com/channel/UChJwQKK0lApGygrgHDGAsfA?view_as=subscriber" class="mysocial" rel="me"><i class="fab fa-youtube fa-3x"></i></a></span>&nbsp;&nbsp;
            <span class="icon is-large"><a href="https://www.instagram.com/toshikun_photo" class="mysocial" rel="me"><i class="fab fa-instagram fa-3x"></i></a></span>&nbsp;&nbsp;
            <span class="icon is-large"><a href="https://github.com/toshikunphoto" class="mysocial" rel="me"><i class="fab fa-github fa-3x"></i></a></span>&nbsp;&nbsp;
            <br><br>
            Copyright &copy; Toshikun Dlife 2020 - Theme by <a href="https://jeffprod.com" class="mysocial">JeffProd.com</a>
            <br>
            <a class="mysocial" href="https://toshikunblog.net/page/contact">問い合わせ</a> - <a class="mysocial" href="https://toshikunblog.net/page/privacypolicy">プライバシーポリシー</a>
        </p>
    </div>
</footer>
<script defer src="https://use.fontawesome.com/releases/v5.1.0/js/all.js"></script>
</body>
</html>
